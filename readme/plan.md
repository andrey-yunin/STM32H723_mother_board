# План работ: Завершение реализации бинарного протокола USB CDC

## Цель этапа:
Полностью завершить переход микроконтроллера на бинарный протокол обмена данными по USB, включая прием команд, отправку всех типов ответов (ACK, DONE, ERROR) и интеграцию с JobManager для обработки команд.

## Выполненные шаги:
*   Объявление и создание FreeRTOS Stream Buffer для приема данных.
*   Модификация функции приема USB CDC (`usbd_cdc_if.c`).
*   Модификация задачи-диспетчера (`task_dispatcher.c`) для сборки бинарных пакетов.
*   Создание функции обработки бинарных команд (`command_parser.c`).
*   Создание функции отправки бинарных ответов (ACK, NACK) (`dispatcher_io.c`).
*   Корректировка `app_init_checker.c`.
*   Обновление `App_user/test_protocol.py` для отправки команды `INIT`.
*   Адаптация `task_usb_handler.c` для корректной отправки бинарных данных.
*   **Успешное тестирование базового взаимодействия с ПК**: ПК отправляет команду `INIT`, и микроконтроллер корректно отвечает бинарным ACK-пакетом, который успешно интерпретируется скриптом на ПК.

## Оставшиеся шаги реализации:

### 1. Расширение логики `Parser_ProcessBinaryCommand` для команды `INIT`:
*   **1.1. Доработка `Parser_ProcessBinaryCommand`**:
    *   В функции `Parser_ProcessBinaryCommand` добавить логику для команды `0x1002` (INIT).
    *   Инициировать запуск соответствующего задания через `JobManager_StartNewJob`.
    *   После завершения задания от `JobManager` отправить соответствующий `DONE`-ответ (0x02) или `ERROR`-ответ (0x04) в зависимости от результата выполнения Job'а.

### 2. Добавление функций для отправки всех типов ответов:
*   **2.1. Добавление `Dispatcher_SendDone` и `Dispatcher_SendError`**:
    *   Создать в `dispatcher_io.h` и `dispatcher_io.c` функции для отправки `DONE`- и `ERROR`-ответов согласно протоколу.
    *   Эти функции будут использоваться после выполнения команд `JobManager`.

## Зависимости:
*   FreeRTOS (Stream Buffer API, Queue API, Semaphore API).
*   Correct operation of USB CDC.
*   Наличие и корректная работа `JobManager`.

## Тестирование:
*   После каждого шага, компиляция и проверка на отсутствие ошибок.
*   Использование `App_user/test_protocol.py` для валидации бинарного обмена.
